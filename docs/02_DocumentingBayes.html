
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>EnvBayes Notebook #2. Documenting a Bayesian Analysis &#8212; Greg Brunkhorst</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="EnvBayes Notebook #3. Hierarchical Model for Stormwater" href="03_HierarchicalStormwater.html" />
    <link rel="prev" title="EnvBayes Notebook #1. Introduction to Bayesian Statistics for Environmental Science" href="01_BayesIntro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Greg Brunkhorst</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="about.html">
                    About
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_BayesIntro.html">
   EnvBayes Notebook #1. Introduction to Bayesian Statistics for Environmental Science
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   EnvBayes Notebook #2. Documenting a Bayesian Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_HierarchicalStormwater.html">
   EnvBayes Notebook #3.  Hierarchical Model for Stormwater
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_Lead210_Master.html">
   EnvBayes Notebook #4.  Bayesian Sediment Geochronology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="logo_asymmetric_laplace.html">
   EnvBayes Logo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="experience.html">
   Greg Brunkhorst, P.E.
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/gbrunkhorst/Website/main?urlpath=lab/tree/02_DocumentingBayes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/gbrunkhorst/Website/blob/main/02_DocumentingBayes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/gbrunkhorst/Website"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gbrunkhorst/Website/issues/new?title=Issue%20on%20page%20%2F02_DocumentingBayes.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/02_DocumentingBayes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#main-points">
   Main Points
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outline-of-a-bayesian-analysis">
   Outline of a Bayesian Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#graphical-depiction-of-the-outline">
     Graphical Depiction of the Outline
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-1-purpose">
   Section 1. Purpose
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     Background
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-bayes">
     Why Bayes?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-2-model-description">
   Section 2. Model Description
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#physical-model">
     Physical Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prior-distributions-for-input-variables">
     Prior Distributions for Input Variables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Background
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#c-d-and-c-0">
       <span class="math notranslate nohighlight">
        \(C_d\)
       </span>
       and
       <span class="math notranslate nohighlight">
        \(C_0\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#r">
       <span class="math notranslate nohighlight">
        \(R\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#b">
       <span class="math notranslate nohighlight">
        \(B\)
       </span>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#likelihood-function-for-output-variable-c-t">
     Likelihood Function for Output Variable
     <span class="math notranslate nohighlight">
      \(C_t\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-model-specification">
     Complete Model Specification
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-3-results">
   Section 3. Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterior">
     Posterior
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#year-30-prediction">
     Year 30 Prediction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-4-discussion">
   Section 4. Discussion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-a-mcmc-diagnostics">
   Appendix A. MCMC Diagnostics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mcmc-chain-convergence">
     MCMC Chain Convergence
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mcmc-chain-resolution">
     MCMC Chain Resolution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-b-prior-and-posterior-predictive-checks">
   Appendix B. Prior and Posterior Predictive Checks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prior-predictive-check">
     Prior Predictive Check
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterior-predictive-checks">
     Posterior Predictive Checks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-c-sensitivity-to-alternative-model-specifications">
   Appendix C. Sensitivity to Alternative Model Specifications
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#informative-priors">
     Informative Priors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison-to-a-linear-model">
     Comparison to a Linear Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   Next Steps
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>EnvBayes Notebook #2. Documenting a Bayesian Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#main-points">
   Main Points
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outline-of-a-bayesian-analysis">
   Outline of a Bayesian Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#graphical-depiction-of-the-outline">
     Graphical Depiction of the Outline
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-1-purpose">
   Section 1. Purpose
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     Background
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purpose">
     Purpose
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-bayes">
     Why Bayes?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-2-model-description">
   Section 2. Model Description
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#physical-model">
     Physical Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prior-distributions-for-input-variables">
     Prior Distributions for Input Variables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Background
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#c-d-and-c-0">
       <span class="math notranslate nohighlight">
        \(C_d\)
       </span>
       and
       <span class="math notranslate nohighlight">
        \(C_0\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#r">
       <span class="math notranslate nohighlight">
        \(R\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#b">
       <span class="math notranslate nohighlight">
        \(B\)
       </span>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#likelihood-function-for-output-variable-c-t">
     Likelihood Function for Output Variable
     <span class="math notranslate nohighlight">
      \(C_t\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-model-specification">
     Complete Model Specification
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-3-results">
   Section 3. Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterior">
     Posterior
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#year-30-prediction">
     Year 30 Prediction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-4-discussion">
   Section 4. Discussion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-a-mcmc-diagnostics">
   Appendix A. MCMC Diagnostics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mcmc-chain-convergence">
     MCMC Chain Convergence
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mcmc-chain-resolution">
     MCMC Chain Resolution
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-b-prior-and-posterior-predictive-checks">
   Appendix B. Prior and Posterior Predictive Checks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prior-predictive-check">
     Prior Predictive Check
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#posterior-predictive-checks">
     Posterior Predictive Checks
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix-c-sensitivity-to-alternative-model-specifications">
   Appendix C. Sensitivity to Alternative Model Specifications
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#informative-priors">
     Informative Priors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison-to-a-linear-model">
     Comparison to a Linear Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   Next Steps
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="envbayes-notebook-2-documenting-a-bayesian-analysis">
<h1>EnvBayes Notebook #2. Documenting a Bayesian Analysis<a class="headerlink" href="#envbayes-notebook-2-documenting-a-bayesian-analysis" title="Permalink to this headline">#</a></h1>
<section id="main-points">
<h2>Main Points<a class="headerlink" href="#main-points" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>A Bayesian analysis has a few additional reporting requirements that will be new to non-Bayesians.</p></li>
<li><p>This notebook is a general introduction to Bayesian reporting by following a simple example.</p></li>
<li><p>Bayesian reporting requirements are well-established in the Bayesian community and can generally be produced in just a few lines of code.</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>EnvBayes Notebook #1 provided an Introduction to Bayesian Statistics for Environmental Science through the lens of a physical model, or data generating process. The Bayesian methodology a natural fit for environmental science, where most problems are grounded in well-understood physical and chemical processes.</p>
<p><strong>However,</strong> the environmental cleanup industry is heavily regulated, and Bayesian models can be unfamiliar and tricky.  Therefore, we need a standard template for presenting the results of a Bayesian analysis. Fortunately, John Kruschke recently published <a class="reference external" href="https://www.nature.com/articles/s41562-021-01177-7"><em>Bayesian Analysis Reporting Guidelines</em></a> (Kruschke, 2021) (BARG), cataloging the core components of a Bayesian report.  Based on his work, and considering the needs of the environmental industry, I have put together this stripped-down example.  Luckily, the Bayesian-specific components of the reporting guidelines have already been implemented in Python in Pymc and Arviz.</p>
<p>This notebook provides a cursory summary of the underlying concepts that support Bayesian techniques.  Two excellent resources for more detail are <a class="reference external" href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical Rethinking</em></a> (McElraith, 2020), and <a class="reference external" href="https://bayesiancomputationbook.com/welcome.html"><em>Bayesian Modeling and Computation in Python</em></a> (Martin, Kumar and Lao, 2022).</p>
</section>
<section id="outline-of-a-bayesian-analysis">
<h2>Outline of a Bayesian Analysis<a class="headerlink" href="#outline-of-a-bayesian-analysis" title="Permalink to this headline">#</a></h2>
<p>Below is the outline adapted from the BARG.  For readability, I have reorganized Kruschke’s checklist to present the core results up front, and the diagnostic checks in the back of the document.  The Bayesian scientist would need to do the diagnostic checks first, but the common reader would want the diagnostic checks in the back.</p>
<p><strong>Main Text</strong></p>
<ol class="simple">
<li><p><em>Purpose and Background</em></p></li>
<li><p><em>Model Description</em></p>
<ul class="simple">
<li><p>Model equations</p></li>
<li><p>Prior distributions for input variables and rationale</p></li>
<li><p>Form of the likelihood function for output variables and rationale</p></li>
<li><p>Complete model specification</p></li>
</ul>
</li>
<li><p><em>Results</em></p>
<ul class="simple">
<li><p>Posterior distributions</p></li>
<li><p>Decision criteria, if relevant (e.g., Bayesian p-values)</p></li>
</ul>
</li>
<li><p><em>Discussion</em></p></li>
</ol>
<p><strong>Appendices</strong></p>
<ul class="simple">
<li><p>A. <em>MCMC Diagnostics</em></p>
<ul>
<li><p>MCMC chain convergence</p></li>
<li><p>MCMC chain resolution</p></li>
</ul>
</li>
<li><p>B. <em>Prior and Posterior Predictive Checks</em></p>
<ul>
<li><p>Prior predictive checks</p></li>
<li><p>Posterior predictive checks</p></li>
</ul>
</li>
<li><p>C. <em>Sensitivity to Alternative Model Specifications</em></p>
<ul>
<li><p>Impact of alternative priors</p></li>
<li><p>Impact of other model choices</p></li>
</ul>
</li>
<li><p>D. <em>Reproducibility</em></p>
<ul>
<li><p>Project code, including data preprocessing, commented code, and documentation.  Jupyter Book does this for me 😀.</p></li>
</ul>
</li>
</ul>
<section id="graphical-depiction-of-the-outline">
<h3>Graphical Depiction of the Outline<a class="headerlink" href="#graphical-depiction-of-the-outline" title="Permalink to this headline">#</a></h3>
<p>At the end of Notebook #1, I presented the following graphical depiction of Bayesian inference:</p>
<p><img alt="BayesianInference" src="_images/BayesianInference.png" /></p>
<p>Now let’s mark it up to show where the information is presented in the report outline</p>
<p><img alt="DocumentationRoadmap" src="_images/DocumentationRoadmap.png" /></p>
<p>Appendix B needs it’s own diagram out of the components of the previous diagram.</p>
<p><img alt="PredictiveChecks" src="_images/PredictiveChecks.png" /></p>
<p>The prior and posterior checks simulate data by running the model  forward, once with the prior distributions (starting distributions) and once with the posterior distributions (the results).</p>
<p>In the next sections, I will work through a bare-bones example with code in Python using the packages Pymc and Arviz.  I’ll use the SEDCAM model presented in EnvBayes Notebook #1 on publically available sediment data from Puget Sound.</p>
</section>
</section>
<section id="section-1-purpose">
<h2>Section 1. Purpose<a class="headerlink" href="#section-1-purpose" title="Permalink to this headline">#</a></h2>
<section id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">#</a></h3>
<p>We want to understand the long-term trends on contaminant concentrations in sediment in Puget Sound, which impacts the health of the ecosystem and people who rely on the ecosystem.  In 2018, the Washington State Department of Ecology published <a class="reference external" href="https://www.researchgate.net/publication/330689038_Sediment_Quality_in_Puget_Sound_Changes_in_chemical_contaminants_and_invertebrate_communities_at_10_sentinel_stations_1989-2015"><em>Sediment Quality in Puget Sound: Changes in chemical contaminants and invertebrate communities at 10 sentinel stations, 1989–2015</em></a>, which presented time trends for multiple contaminants in surface sediment over time.  For illustrative purpose, I pulled data from 2000-2016 for benzo(a)pyrene (BaP) from Station 3 in the Straight of Georgia in the north end of Puget Sound.</p>
<p>BaP is a heavy carcinogenic polycyclic aromatic hydrocarbon that is persistent in the environment with very low biodegradation rates.  It is a concern to human health, particularly to those eating shellfish.  A source of BaP is combustion, therefore there are ongoing, low-level inputs of BaP to sediment from general urban activities.  Due to these characteristics, I thought the dataset would provide a nice example for this analysis.  Note that there are nuances to this dataset that I’m leaving out of this analysis, so that I can focus on the Bayesian modeling.</p>
<p>Import and Plot Data</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">custom_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;axes.spines.right&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;axes.spines.top&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="o">=</span><span class="n">custom_params</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.colheader_justify&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/gbrunkhorst/Website/main/data/&#39;</span>
<span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;Straight_Georgia_BaP_PSAMP_Data.csv&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: center;">
      <th></th>
      <th>Location_ID</th>
      <th>Date</th>
      <th>Matrix</th>
      <th>Upper_Depth</th>
      <th>Lower_Depth</th>
      <th>Depth_Unit</th>
      <th>Chemical</th>
      <th>Concentration</th>
      <th>Result_Unit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PSAMP_LT-3</td>
      <td>4/20/2000</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>45.00</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PSAMP_LT-3</td>
      <td>4/22/2005</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>20.00</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PSAMP_LT-3</td>
      <td>4/22/2005</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>21.00</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PSAMP_LT-3</td>
      <td>4/22/2005</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>19.00</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PSAMP_LT-3</td>
      <td>4/25/2010</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>9.84</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>5</th>
      <td>PSAMP_LT-3</td>
      <td>4/25/2010</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>10.10</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>6</th>
      <td>PSAMP_LT-3</td>
      <td>4/25/2010</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>12.30</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>7</th>
      <td>PSAMP_LT-3</td>
      <td>4/28/2016</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>9.16</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>8</th>
      <td>PSAMP_LT-3</td>
      <td>4/28/2016</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>6.62</td>
      <td>ug/Kg</td>
    </tr>
    <tr>
      <th>9</th>
      <td>PSAMP_LT-3</td>
      <td>4/28/2016</td>
      <td>Sediment Surface</td>
      <td>0</td>
      <td>3</td>
      <td>cm</td>
      <td>Benzo(a)pyrene</td>
      <td>10.50</td>
      <td>ug/Kg</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">Date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">Year</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Year</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<span class="c1">#plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Concentration&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BaP in Surface Sediment 2000-2016</span><span class="se">\n</span><span class="s1">Station 3, Straight of Georgia, Puget Sound&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_17_0.png" src="_images/02_DocumentingBayes_17_0.png" />
</div>
</div>
</section>
<section id="purpose">
<h3>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">#</a></h3>
<p>The purpose of this analysis is to:</p>
<ul class="simple">
<li><p>Estimate future concentrations of BaP at the location and the uncertainty in the estimate.</p></li>
<li><p>Link the estimate to physical processes, including the rate of depositing sediment and the concentration of BaP in depositing sediment.</p></li>
</ul>
</section>
<section id="why-bayes">
<h3>Why Bayes?<a class="headerlink" href="#why-bayes" title="Permalink to this headline">#</a></h3>
<p>A Bayesian approach was selected for this analysis because it accommodates non-linear modeling (in this case, exponential decay to an asymptote), transparently incorporates prior knowledge, and provides uncertainty estimates for all model parameters.</p>
</section>
</section>
<section id="section-2-model-description">
<h2>Section 2. Model Description<a class="headerlink" href="#section-2-model-description" title="Permalink to this headline">#</a></h2>
<section id="physical-model">
<h3>Physical Model<a class="headerlink" href="#physical-model" title="Permalink to this headline">#</a></h3>
<p>The SEDCAM model (<a class="reference external" href="https://www.eopugetsound.org/sites/default/files/features/resources/PugetSoundResearch1988Vol2Optimized_0.pdf">Jacobs et al. 1988</a>) is an exponential decay equation that predicts the future concentration of a contaminant in sediment from a starting concentration, a depositing concentration, a deposition rate and a mixing depth in sediment.  The SEDCAM model is reasonable for modeling BaP in this location because it captures the general physical characteristics of sediments in the area (historical contaminant releases, followed by deposition and mixing), and because the data appear to follow the trend of exponential decay to an asymptote.  The model assumes a constant deposition rate and depositing concentration over time, which is a reasonable starting place for this analysis.  The model equation is as follows:</p>
<div class="math notranslate nohighlight">
\[
C_t = C_d(1-e^{-Rt/B}) + C_0e^{-Rt/B}
\]</div>
<p>Where:<br />
<span class="math notranslate nohighlight">\(C_t = \)</span> the surface sediment contaminant concentration at time <span class="math notranslate nohighlight">\(t\)</span><br />
<span class="math notranslate nohighlight">\(C_d = \)</span> the contaminant concentration in depositing sediment<br />
<span class="math notranslate nohighlight">\(C_0 = \)</span> the starting contaminant concentration<br />
<span class="math notranslate nohighlight">\(R = \)</span> the sedimentation rate<br />
<span class="math notranslate nohighlight">\(t = \)</span> time<br />
<span class="math notranslate nohighlight">\(B = \)</span> depth of the biologically active zone</p>
</section>
<section id="prior-distributions-for-input-variables">
<h3>Prior Distributions for Input Variables<a class="headerlink" href="#prior-distributions-for-input-variables" title="Permalink to this headline">#</a></h3>
<section id="id1">
<h4>Background<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<p>The selection of priors can be a stumbling block for Bayesian analysis, because of varying opinion on the approach to establishing prior probabilities.  However, a systematic approach to selecting priors can be straight forward to implement, and the selection of different prior probabilities can be readily compared.  In many cases, the width of the priors will not impact the results very much.</p>
<p>Approaches to prior specification can be summarized as the following:</p>
<ul class="simple">
<li><p><em>Informative.</em>  Informative priors use existing information and past studies to provide narrow probability distributions to the model.  Informative priors may have a large impact the results of the analysis.</p></li>
<li><p><em>Weakly informative.</em> Weakly informative priors use existing information to provide wide probability distributions to the model.  Weakly informative priors are considered the default choice in many applications.  Packages that automatically generate prior distributions (e.g., <a class="reference external" href="https://mc-stan.org/rstanarm/">rstanarm</a> and <a class="reference external" href="https://bambinos.github.io/bambi/main/index.html">Bambi</a>) use weakly informative priors.  Weakly informative priors will minimally impact the results of the analysis, so that the data can speak for themselves.</p></li>
<li><p><em>Uninformative.</em>  Uninformative priors are used to maximize the skepticism that is brought to the analysis and can be used to replicate frequentist results for some models.  However, it can be challenging to implement uninformative priors for many models because prior predictions are not in the ballpark of the data.</p></li>
<li><p><em>Adaptive.</em> Adaptive priors are used in hierarchical models for categorical data, and allow data to share information across categories.  Adaptive priors are the default method for assigning priors for categorical data (depending on the goals of the study).</p></li>
</ul>
<p>Overall, the approach in this notebook is to use available data to develop prior distributions, but keep the analysis very simple.  Think of this as a “back-of-the-envelope meta-analysis.”  Here are some additional principles for development of priors:</p>
<ul class="simple">
<li><p>Use informative priors for parameters with a lot of background information (e.g., replicating a past study), or for parameters that should be held relatively constant in the model.</p></li>
<li><p>Use weakly informative priors for parameters with more uncertainty, or parameters particular interest in the analysis.</p></li>
<li><p>Use adaptive priors for categorical data when applicable (this notebook does not use adaptive priors).</p></li>
<li><p>Run the model with different priors to compare the results.  If the two results are similar, then prior specification isn’t worth stressing over.</p></li>
<li><p>Use the model to help select priors.  Prior predictive checks can help to demonstrate whether priors are in the ballpark, and the posterior MCMC inference algorithm will often produce errors when priors are poorly specified.</p></li>
</ul>
<p>The rest of this section documents the selection of priors for the four input variables, <span class="math notranslate nohighlight">\(C_d\)</span>, <span class="math notranslate nohighlight">\(C_0\)</span>, <span class="math notranslate nohighlight">\(R\)</span>, and <span class="math notranslate nohighlight">\(B\)</span>.</p>
</section>
<section id="c-d-and-c-0">
<h4><span class="math notranslate nohighlight">\(C_d\)</span> and <span class="math notranslate nohighlight">\(C_0\)</span><a class="headerlink" href="#c-d-and-c-0" title="Permalink to this headline">#</a></h4>
<p>Prior distributions for <span class="math notranslate nohighlight">\(C_d\)</span> and <span class="math notranslate nohighlight">\(C_0\)</span> are based on summary statistics from a back-of-the-envelope meta-analysis.  BaP data from the longitudinal studies within all of Puget Sound (study IDs PSAMP_LT and PSEMP_LT in Washington State Department of Ecology’s EIM database) were downloaded and aggregated without adjusting for date, location, detection limits, etc.  The resulting dataset had 292 samples with a mean of 136 ug/kg and a standard deviation of 347 ug/kg, which will be the mean and standard deviation of a normal prior distribution.  Both <span class="math notranslate nohighlight">\(C_d\)</span> and <span class="math notranslate nohighlight">\(C_0\)</span> will use the same prior so that differences in the two values will be based on the data only (we will not make a prior assumption that concentrations are increasing or decreasing).  We will also truncate the distribution at 0 to enforce positive-only results.</p>
</section>
<section id="r">
<h4><span class="math notranslate nohighlight">\(R\)</span><a class="headerlink" href="#r" title="Permalink to this headline">#</a></h4>
<p>The prior deposition rates, <span class="math notranslate nohighlight">\(R\)</span>, known to be around 1 cm/year in central Puget Sound.  To ground the prior in empirical data, the historical study documented in <a class="reference external" href="https://www.pmel.noaa.gov/pubs/PDF/lave732/lave732.pdf">Lavelle et. al. 1986</a> is referenced, which found a mean deposition rate of 1.5 cm/year with a standard deviation of about 1.2 cm/year in 25 locations.  This wide range of potential deposition rates from multiple areas of Puget Sound is considered weakly informative.  We use a truncated normal distribution to enforce positive-only results.</p>
</section>
<section id="b">
<h4><span class="math notranslate nohighlight">\(B\)</span><a class="headerlink" href="#b" title="Permalink to this headline">#</a></h4>
<p>Finally, 10 cm is the widely established default bioturbation depth (<span class="math notranslate nohighlight">\(B\)</span>) in Puget Sound (e.g., <a class="reference external" href="https://apps.ecology.wa.gov/publications/documents/1209057.pdf">Ecology 2021</a>), so we will give a tight bound on the prior with normal distribution with a mean of 10 cm and a standard deviation of 1 cm.  This is an informative prior distribution because of the relative narrowness of the distribution.</p>
</section>
</section>
<section id="likelihood-function-for-output-variable-c-t">
<h3>Likelihood Function for Output Variable <span class="math notranslate nohighlight">\(C_t\)</span><a class="headerlink" href="#likelihood-function-for-output-variable-c-t" title="Permalink to this headline">#</a></h3>
<p>The likelihood function represents the error (i.e., noise or spread) of the measured <span class="math notranslate nohighlight">\(C_t\)</span> around the SEDCAM prediction for <span class="math notranslate nohighlight">\(C_t\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Cd</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">B</span><span class="p">))</span> <span class="o">+</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">B</span><span class="p">)</span>

<span class="c1">#Specify variable values for plotting. </span>
<span class="n">Cd</span> <span class="o">=</span> <span class="mi">10</span>                     <span class="c1"># ug/kg contaminant</span>
<span class="n">C0</span> <span class="o">=</span> <span class="mi">100</span>                    <span class="c1"># ug/kg contaminant</span>
<span class="n">R</span> <span class="o">=</span> <span class="mi">1</span>                       <span class="c1"># cm/year</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10</span>                      <span class="c1"># cm</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># years (0-30 in 100 increments)</span>


<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">colors</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model Equation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$ (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C_t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Likelihood Function Depiction&#39;</span><span class="p">)</span>

<span class="n">coverage</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">height_multiplier</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">coverage</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">coverage</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">height_multiplier</span>

<span class="n">t</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">y_offset</span> <span class="o">=</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model $C_t$ = Mean of Likelihood Function&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">y_offset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Likelihood Function $</span><span class="si">{Normal}</span><span class="s1">$($C_t$, $sigma$)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed Data&#39;</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">t</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">y_offset</span> <span class="o">=</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">y_offset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">t</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">y_offset</span> <span class="o">=</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">y_offset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_25_0.png" src="_images/02_DocumentingBayes_25_0.png" />
</div>
</div>
<p>For this analysis, we will use a normally distributed likelihood centered on the SEDCAM model prediction and with a standard deviation determined by the model.  A normal distribution is used because the data do not appear highly skewed and outliers do not appear to be present.  The normal distribution is also consistent with the common least-squares approach to model fitting.</p>
<p>The standard deviation of the likelihood function will be determined by the model, and start with a weakly informative prior of a half-normal distribution centered on 0 with a standard deviation of 347 ug/kg, consistent with the variance in BaP values in longitudinal Puget Sound studies.</p>
</section>
<section id="complete-model-specification">
<h3>Complete Model Specification<a class="headerlink" href="#complete-model-specification" title="Permalink to this headline">#</a></h3>
<p>The complete model specification in Pymc is as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">sedcam_bayes</span><span class="p">:</span>
    <span class="c1"># Data</span>
    <span class="n">t_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MutableData</span><span class="p">(</span><span class="s1">&#39;t_obs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">Ct_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MutableData</span><span class="p">(</span><span class="s1">&#39;Ct_obs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    
    <span class="c1"># Priors</span>
    <span class="n">Cd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;Cd&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">136</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">347</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">136</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">347</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># SEDCAM Prediction</span>
    <span class="n">Ct</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span> <span class="n">Cd</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t_obs</span><span class="o">/</span><span class="n">B</span><span class="p">))</span> <span class="o">+</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t_obs</span><span class="o">/</span><span class="n">B</span><span class="p">))</span>

    <span class="c1"># Likelihood</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">347</span><span class="p">)</span>
    <span class="n">Ct_modeled</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">Ct</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">Ct_obs</span><span class="p">)</span>
<span class="n">sedcam_bayes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}
            \begin{array}{rcl}
            \text{Cd} &amp;\sim &amp; \operatorname{TruncatedNormal}(136,~347,~0,~inf)\\\text{C0} &amp;\sim &amp; \operatorname{TruncatedNormal}(136,~347,~0,~inf)\\\text{R} &amp;\sim &amp; \operatorname{TruncatedNormal}(1.5,~1.2,~0,~inf)\\\text{B} &amp;\sim &amp; \operatorname{TruncatedNormal}(10,~1,~0,~inf)\\\text{sigma} &amp;\sim &amp; \operatorname{N^{+}}(0,~347)\\\text{Ct} &amp;\sim &amp; \operatorname{Deterministic}(f(\text{C0},~\text{Cd},~\text{B},~\text{R}))\\\text{Ct_modeled} &amp;\sim &amp; \operatorname{N}(\text{Ct},~\text{sigma})
            \end{array}
            \end{split}\]</div>
</div>
</div>
<p>Pymc provides a graphical representation of the model as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If graphviz is not installed, and you want the graph visual, uncomment and run the conda install</span>
<span class="c1"># !conda install -c conda-forge python-graphviz -y</span>
<span class="n">pm</span><span class="o">.</span><span class="n">model_to_graphviz</span><span class="p">(</span><span class="n">sedcam_bayes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_30_0.svg" src="_images/02_DocumentingBayes_30_0.svg" /></div>
</div>
</section>
</section>
<section id="section-3-results">
<h2>Section 3. Results<a class="headerlink" href="#section-3-results" title="Permalink to this headline">#</a></h2>
<p>Fit the model.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">sedcam_bayes</span><span class="p">:</span>
    <span class="n">prior</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_prior_predictive</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
    <span class="n">post_pred</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initializing NUTS using jitter+adapt_diag...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Multiprocess sampling (4 chains in 4 jobs)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NUTS: [Cd, C0, R, B, sigma]
</pre></div>
</div>
</div>
</div>
<section id="posterior">
<h3>Posterior<a class="headerlink" href="#posterior" title="Permalink to this headline">#</a></h3>
<p>The posterior results are the meat of the analysis.  Let’s plot 50 samples from the posterior distribution to get an idea of the spread of results.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Cd</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">B</span><span class="p">))</span> <span class="o">+</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">B</span><span class="p">)</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">Cd</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">C0</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration of Contaminant&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Observed&#39;</span><span class="p">,</span> 
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posterior Samples&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_35_0.png" src="_images/02_DocumentingBayes_35_0.png" />
</div>
</div>
<p>The range of predictions is reasonable based on the data.  We can see how the predictions become less certain the further we extrapolate into the future, as we go beyond the observed data.  Now we will look at the probability distributions for each of the parameters.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C0 - initial concentration (ug/kg)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Cd - depositing concentration (ug/kg)&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;R - deposition rate (cm/yr)&#39;</span><span class="p">,</span>  
            <span class="s1">&#39;B - bioactive mixing depth (cm)&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;Sigma (error) (ug/kg)&#39;</span><span class="p">]</span>
<span class="n">var_names</span><span class="o">=</span><span class="p">[</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;Cd&#39;</span><span class="p">,</span>  <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span>
        <span class="n">textsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Posterior Distributions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_37_0.png" src="_images/02_DocumentingBayes_37_0.png" />
</div>
</div>
<p>The plots present the posterior probability distributions for each parameter, highlighting the mean and the 90% highest density interval.</p>
<p>The results are generally what we would expect based on the data.  Note that <span class="math notranslate nohighlight">\(B\)</span> did not change much based on the data, because the prior was more informative than the priors for the other parameters.  The other parameters, which had weakly informative prior, had larger differences between the prior and posterior.</p>
<p>Here is the same information in tabular form:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">labels</span><span class="p">)))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: center;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_5%</th>
      <th>hdi_95%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C0 - initial concentration (ug/kg)</th>
      <td>45.0</td>
      <td>2.0</td>
      <td>42.0</td>
      <td>48.2</td>
    </tr>
    <tr>
      <th>Cd - depositing concentration (ug/kg)</th>
      <td>7.2</td>
      <td>1.4</td>
      <td>5.0</td>
      <td>9.4</td>
    </tr>
    <tr>
      <th>R - deposition rate (cm/yr)</th>
      <td>2.2</td>
      <td>0.3</td>
      <td>1.7</td>
      <td>2.8</td>
    </tr>
    <tr>
      <th>B - bioactive mixing depth (cm)</th>
      <td>10.0</td>
      <td>1.0</td>
      <td>8.5</td>
      <td>11.8</td>
    </tr>
    <tr>
      <th>Sigma (error) (ug/kg)</th>
      <td>1.8</td>
      <td>0.6</td>
      <td>1.0</td>
      <td>2.7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It is also worth noting that the posterior distributions are correlated.  Logically, we know this should be true.  For example, suppose we have a large rate of decline in concentration.  A really low depositing concentration <span class="math notranslate nohighlight">\(C_d\)</span> could achieve this, and it would not require a large deposition rate <span class="math notranslate nohighlight">\(R\)</span>.  In contrast, a higher <span class="math notranslate nohighlight">\(C_d\)</span> would need a larger deposition rate <span class="math notranslate nohighlight">\(R\)</span> to get the same rate of decline.  So our reasoning tells us that <span class="math notranslate nohighlight">\(C_d\)</span> and <span class="math notranslate nohighlight">\(R\)</span> are positively correlated.  Let’s see if the Bayesian analysis figured that out:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_pair</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">marginals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">scatter_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">.1</span><span class="p">},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Joint Posterior Distribution Plots for $C_d$ and $R$&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_41_0.png" src="_images/02_DocumentingBayes_41_0.png" />
</div>
</div>
<p>Yes it did!  This information could be useful in understanding uncertainties in the analysis.  For example, if we are skeptical of very high values of <span class="math notranslate nohighlight">\(R\)</span>, then we should likewise be skeptical of high values of <span class="math notranslate nohighlight">\(C_d\)</span>.</p>
</section>
<section id="year-30-prediction">
<h3>Year 30 Prediction<a class="headerlink" href="#year-30-prediction" title="Permalink to this headline">#</a></h3>
<p>Recall that one of the purposes of the analysis was to estimate the predicted concentrations in the future.  We can estimate the future mean concentrations using the posterior, and the future distribution of sample data using posterior predictions for year 30.</p>
<p>Posterior predictive sample at year 30.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set year to 30</span>
<span class="n">sedcam_bayes</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="s1">&#39;t_obs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">30</span><span class="p">])</span>
<span class="c1"># simulate data</span>
<span class="k">with</span> <span class="n">sedcam_bayes</span><span class="p">:</span>
    <span class="n">post_pred_30</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
  <progress value='4000' class='' max='4000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4000/4000 00:00&lt;00:00]
</div>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
             <span class="n">textsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Predicted Underlying Mean Concentration at Year 30&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_posterior</span><span class="p">(</span><span class="n">post_pred_30</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>  <span class="n">textsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Predicted Sample Concentrations at Year 30&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_46_0.png" src="_images/02_DocumentingBayes_46_0.png" />
</div>
</div>
<p>These results make intuitive sense.  The mean of both distributions is the same, and the range in sample concentrations would be wider than the range in underlying mean concentrations.</p>
</section>
</section>
<section id="section-4-discussion">
<h2>Section 4. Discussion<a class="headerlink" href="#section-4-discussion" title="Permalink to this headline">#</a></h2>
<p>The Bayesian methodology was able to provide coherent uncertainty estimates for all model parameters, given the data.  There are lots of ways to adapt this model to answer additional questions, include other chemicals, other locations, or longer time frames, incorporate changing conditions over time, etc.</p>
<p>The next sections, the “Appendices,” dig into model diagnostics and model checking to demonstrate that these results were reliable from a modeling standpoint.</p>
</section>
<section id="appendix-a-mcmc-diagnostics">
<h2>Appendix A. MCMC Diagnostics<a class="headerlink" href="#appendix-a-mcmc-diagnostics" title="Permalink to this headline">#</a></h2>
<p>The Python package Arviz provides a bunch of functions for performing MCMC diagnostics.  A great resource to learn more is <em>Bayesian Modeling and Computation in Python</em> <a class="reference external" href="https://bayesiancomputationbook.com/markdown/chp_02.html">Chapter 2</a>.  In this appendix, I’ll present and briefly introduce the most common diagnostic tools.</p>
<section id="mcmc-chain-convergence">
<h3>MCMC Chain Convergence<a class="headerlink" href="#mcmc-chain-convergence" title="Permalink to this headline">#</a></h3>
<p>The way that Pymc estimates the posterior probability distribution for each parameter is by sampling the distribution many times (e.g., ~8000).  The MCMC sampler doesn’t know the probability of the whole distribution, but it does know the relative probability (and the gradient) in each step along the way.  With this information, the cleverly-designed MCMC algorithm will hang out in areas with higher probability more than areas with lower probability - in the exact proportion to their comparative probabilities!  Once the sampling is complete, then entire sample (i.e., the “trace,” or the “long list of locations the MCMC algorithm explored”) defines the approximate posterior probability.</p>
<p>Because there is some degree of randomness in the MCMC algorithm, Pymc will will run it multiple times so that we can check that we are getting the same results each time (i.e., for each chain). The trace plot plots the chains separately so we can see if they line up.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;MCMC Trace Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_52_0.png" src="_images/02_DocumentingBayes_52_0.png" />
</div>
</div>
<p>The left column of the trace plots show the final probability distribution for each chain.  As long as they line up fairly well, then the MCMC sampler “converged.”  <em>Bayesian Modeling and Computation in Python</em> <a class="reference external" href="https://bayesiancomputationbook.com/markdown/chp_02.html">Section 2.4.4</a> shows some examples of trace plots for inferences that have not converged.</p>
<p>The right column of the trace plot shows the MCMC chains over time.  They should look like white noise, or fuzzy caterpillars.  These plots are good for identifying if a chain got stuck along the way (which would show as a horizontal line), or another pathology.</p>
<p>On each subplot you might see tick marks on the x-axis.  These are “divergences” where the MCMC algorithm gives an error message when it gets an unexpected result.  Divergences can help to diagnose modeling errors and potential remedies.  However, having a few divergences does not indicate that the inference failed, provided the traces look good otherwise.</p>
<p>Convergence metrics are also provided by the Arviz package.  <code class="docutils literal notranslate"><span class="pre">r_hat</span></code> measures the convergence and should generally be 1.01 or below, according to rule of thumb.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)[[</span><span class="s1">&#39;r_hat&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: center;">
      <th></th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C0</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Cd</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>R</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>B</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>sigma</th>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Based on the visual and tabular diagnostic checks, the MCMC chains converged.</p>
</section>
<section id="mcmc-chain-resolution">
<h3>MCMC Chain Resolution<a class="headerlink" href="#mcmc-chain-resolution" title="Permalink to this headline">#</a></h3>
<p>The MCMC algorithm can get stuck in certain areas of the parameter space, and might not be able to explore the entire parameter space.  The common metric to check for MCMC chain resolution is effective sample size (ESS), which provide a measure for the effective number of samples in the trace by examining the autocorrelation among MCMC samples.  Again, more information in <a class="reference external" href="https://bayesiancomputationbook.com/markdown/chp_02.html"><em>Bayesian Modeling and Computation in Python</em></a>.  A general rule of thumb is that more than 400 samples are needed to have a good characterization of the posterior distribution.</p>
<p>The tail of the distributions take longer to characterize than the center of the distributions, because the sampler will hang out less in the tail than in the center.  Therefore, Arviz provides values for ESS in the entire distribution (bulk) and in the tails only (based on the 5th and 95th percentiles).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)[[</span><span class="s1">&#39;ess_bulk&#39;</span><span class="p">,</span> <span class="s1">&#39;ess_tail&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: center;">
      <th></th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C0</th>
      <td>2533.0</td>
      <td>1813.0</td>
    </tr>
    <tr>
      <th>Cd</th>
      <td>1960.0</td>
      <td>1167.0</td>
    </tr>
    <tr>
      <th>R</th>
      <td>1740.0</td>
      <td>2294.0</td>
    </tr>
    <tr>
      <th>B</th>
      <td>2740.0</td>
      <td>2176.0</td>
    </tr>
    <tr>
      <th>sigma</th>
      <td>1552.0</td>
      <td>2134.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Based on the table above, the MCMC chain resolution is sufficient.</p>
</section>
</section>
<section id="appendix-b-prior-and-posterior-predictive-checks">
<h2>Appendix B. Prior and Posterior Predictive Checks<a class="headerlink" href="#appendix-b-prior-and-posterior-predictive-checks" title="Permalink to this headline">#</a></h2>
<p>Prior and posterior predictive checks are also a meaningful way to assess the behavior of a Bayesian model.  This section provides graphical results for prior and posterior predictive checks.</p>
<section id="prior-predictive-check">
<h3>Prior Predictive Check<a class="headerlink" href="#prior-predictive-check" title="Permalink to this headline">#</a></h3>
<p>The prior predictive sample is a forward simulation on the prior distributions without inference on the observed data. The purpose of the prior predictive check is to see that the prior distributions are in the right ballpark and to understand which direction the choice of priors could be biasing our results.</p>
<p>In the following figure, I’ll plot 50 samples from the prior predictive check and 50 samples from the posterior to compare.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cd0</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">C00</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">B0</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C00</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B0</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration of Contaminant&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Observed&#39;</span><span class="p">,</span> 
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Prior Predictive Check</span><span class="se">\n</span><span class="s1">Comparison of Prior and Posterior&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_63_0.png" src="_images/02_DocumentingBayes_63_0.png" />
</div>
</div>
<p>The priors are generally in the ballpark, but much higher than the posterior. Therefore, if the priors are nudging the results in a particular direction, they are nudging the results toward higher concentrations, more variance, and less decline in concentration.</p>
</section>
<section id="posterior-predictive-checks">
<h3>Posterior Predictive Checks<a class="headerlink" href="#posterior-predictive-checks" title="Permalink to this headline">#</a></h3>
<p>Another benefit of Bayesian modelling is that the fit model can be used to generate synthetic datasets, which can be  visually compared to the observed dataset to see if the characteristics are similar.  The following plot show several draws from the posterior predictive sample.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">800</span><span class="p">]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idxs</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">C0</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> 
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior Mean&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">idx</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Observed&#39;</span><span class="p">,</span> 
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="c1">#ax.set_title(&#39;Observed&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="p">,</span>
                <span class="n">post_pred</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Generated&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="c1">#ax.set_title(&#39;Generated&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Posterior Predictive Check - Visual Comparison of Observed and Generated Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_66_0.png" src="_images/02_DocumentingBayes_66_0.png" />
</div>
</div>
<p>Based on this visual check, the model is generating reasonable data.</p>
<p>To check the likelihood shape, we will plot the observed data and the posterior predictive samples as residual errors against the mean model predictions.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_pred</span> <span class="o">=</span>  <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">C0</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">R</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">post_pred_resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_pred</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> 
                   <span class="n">post_pred</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4000</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">mean_pred</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mean_pred</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span> 
           <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted (ug/kg)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Residual (ug/kg)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">mean_pred</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span>  <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">post_pred_resid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior Predictive&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">mean_pred</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">post_pred_resid</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Residual (ug/kg)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison of Observed and </span><span class="se">\n</span><span class="s1">Posterior Predictive&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Residuals Analysis - Observed and Posterior Predictive&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_68_0.png" src="_images/02_DocumentingBayes_68_0.png" />
</div>
</div>
<p>The left-hand plot shows that the model is not systematically biased relative to the magnitude of the prediction.  The right-hand plot shows that the posterior predictive distribution is a reasonable shape compared to the observed data.  The posterior predictive distribution is systematically wider than the observed data based on the plot on the right, but this is reasonable for a small dataset (n=10).</p>
</section>
</section>
<section id="appendix-c-sensitivity-to-alternative-model-specifications">
<h2>Appendix C. Sensitivity to Alternative Model Specifications<a class="headerlink" href="#appendix-c-sensitivity-to-alternative-model-specifications" title="Permalink to this headline">#</a></h2>
<p>There are infinitely many models that could be used in any situation, and the selection of model specification will rely on the judgement of the researcher.  However, it may be useful to run alternative specifications of the model to present side-by-side with the final selected model for reference.  This appendix will first rerun the model with a different prior specification for comparison.  Next, this appendix will run a completely different model and use the common metrics for comparing models.</p>
<section id="informative-priors">
<h3>Informative Priors<a class="headerlink" href="#informative-priors" title="Permalink to this headline">#</a></h3>
<p>The prior predictive check showed that the prior distributions resulted in concentrations that were much higher than the observed data.  If we have prior reason to believe that concentrations are declining, we can use informative priors with higher concentrations for <span class="math notranslate nohighlight">\(C_d\)</span> compared to <span class="math notranslate nohighlight">\(C_0\)</span>, and establish both of them closer to the expected concentrations.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">sedcam_bayes</span><span class="p">:</span>
    <span class="c1"># Data</span>
    <span class="n">t_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MutableData</span><span class="p">(</span><span class="s1">&#39;t_obs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">Ct_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MutableData</span><span class="p">(</span><span class="s1">&#39;Ct_obs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    
    <span class="c1"># Priors</span>
    <span class="n">Cd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;Cd&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Model Prediction</span>
    <span class="n">Ct</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span> <span class="n">Cd</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t_obs</span><span class="o">/</span><span class="n">B</span><span class="p">))</span> <span class="o">+</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t_obs</span><span class="o">/</span><span class="n">B</span><span class="p">))</span>

    <span class="c1"># Likelihood</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">Ct_modeled</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">Ct</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">Ct_obs</span><span class="p">)</span>
<span class="n">sedcam_bayes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}
            \begin{array}{rcl}
            \text{Cd} &amp;\sim &amp; \operatorname{TruncatedNormal}(10,~5,~0,~inf)\\\text{C0} &amp;\sim &amp; \operatorname{TruncatedNormal}(50,~10,~0,~inf)\\\text{R} &amp;\sim &amp; \operatorname{TruncatedNormal}(1.5,~1.2,~0,~inf)\\\text{B} &amp;\sim &amp; \operatorname{TruncatedNormal}(10,~1,~0,~inf)\\\text{sigma} &amp;\sim &amp; \operatorname{N^{+}}(0,~2)\\\text{Ct} &amp;\sim &amp; \operatorname{Deterministic}(f(\text{C0},~\text{Cd},~\text{B},~\text{R}))\\\text{Ct_modeled} &amp;\sim &amp; \operatorname{N}(\text{Ct},~\text{sigma})
            \end{array}
            \end{split}\]</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">sedcam_bayes</span><span class="p">:</span>
    <span class="n">prior_informative</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_prior_predictive</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">trace_informative</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Cd, C0, R, B, sigma]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
  <progress value='8000' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [8000/8000 00:26&lt;00:00 Sampling 4 chains, 0 divergences]
</div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 54 seconds.
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">Cd0</span> <span class="o">=</span> <span class="n">prior_informative</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">prior_informative</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">C00</span> <span class="o">=</span> <span class="n">prior_informative</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">B0</span> <span class="o">=</span> <span class="n">prior_informative</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">Cd</span> <span class="o">=</span> <span class="n">trace_informative</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">trace_informative</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">C0</span> <span class="o">=</span> <span class="n">trace_informative</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">trace_informative</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C00</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B0</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration of Contaminant&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Data Point&#39;</span><span class="p">,</span> 
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Prior Predictive Check</span><span class="se">\n</span><span class="s1">Comparison of Prior and Posterior&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_74_0.png" src="_images/02_DocumentingBayes_74_0.png" />
</div>
</div>
<p>Informative priors are closer to the observed trend and are less biased than the weakly informative priors.  Now, let’s compare posteriors:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C0 - initial concentration (ug/kg)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Cd - depositing concentration (ug/kg)&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;R - deposition rate (cm/yr)&#39;</span><span class="p">,</span>  
            <span class="s1">&#39;B - bioactive mixing depth (cm)&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;Sigma (error) (ug/kg)&#39;</span><span class="p">]</span>
<span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;hdi_5%&#39;</span><span class="p">,</span> <span class="s1">&#39;hdi_95%&#39;</span><span class="p">]</span>
<span class="n">weakly_informative</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)[</span> <span class="n">cols</span> <span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">labels</span><span class="p">)))</span>
<span class="n">informative</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace_informative</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)[</span> <span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="n">labels</span><span class="p">)))</span>
<span class="n">pct_change</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">weakly_informative</span> <span class="o">+</span> <span class="n">informative</span><span class="p">)</span><span class="o">/</span><span class="n">weakly_informative</span><span class="o">*</span><span class="mi">100</span>
<span class="n">weakly_informative</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s1">&#39;With Weakly Informative Priors (First Model)&#39;</span><span class="p">],</span> <span class="n">weakly_informative</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
<span class="n">informative</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s1">&#39;With Informative Priors (Second Model)&#39;</span><span class="p">],</span> <span class="n">informative</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
<span class="n">pct_change</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s1">&#39;Percent Change (First Model to Second Model)&#39;</span><span class="p">],</span> <span class="n">pct_change</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">weakly_informative</span><span class="p">,</span> <span class="n">informative</span><span class="p">,</span> <span class="n">pct_change</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">With Weakly Informative Priors (First Model)</th>
      <th colspan="3" halign="left">With Informative Priors (Second Model)</th>
      <th colspan="3" halign="left">Percent Change (First Model to Second Model)</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>hdi_5%</th>
      <th>hdi_95%</th>
      <th>mean</th>
      <th>hdi_5%</th>
      <th>hdi_95%</th>
      <th>mean</th>
      <th>hdi_5%</th>
      <th>hdi_95%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C0 - initial concentration (ug/kg)</th>
      <td>45.0</td>
      <td>42.0</td>
      <td>48.2</td>
      <td>45.2</td>
      <td>42.5</td>
      <td>47.9</td>
      <td>0.3</td>
      <td>1.2</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>Cd - depositing concentration (ug/kg)</th>
      <td>7.2</td>
      <td>5.0</td>
      <td>9.4</td>
      <td>7.4</td>
      <td>5.6</td>
      <td>9.3</td>
      <td>2.3</td>
      <td>10.8</td>
      <td>-1.3</td>
    </tr>
    <tr>
      <th>R - deposition rate (cm/yr)</th>
      <td>2.2</td>
      <td>1.7</td>
      <td>2.8</td>
      <td>2.3</td>
      <td>1.7</td>
      <td>2.8</td>
      <td>0.9</td>
      <td>3.3</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>B - bioactive mixing depth (cm)</th>
      <td>10.0</td>
      <td>8.5</td>
      <td>11.8</td>
      <td>10.0</td>
      <td>8.4</td>
      <td>11.6</td>
      <td>-0.1</td>
      <td>-0.9</td>
      <td>-1.3</td>
    </tr>
    <tr>
      <th>Sigma (error) (ug/kg)</th>
      <td>1.8</td>
      <td>1.0</td>
      <td>2.7</td>
      <td>1.7</td>
      <td>1.0</td>
      <td>2.3</td>
      <td>-9.7</td>
      <td>-4.0</td>
      <td>-15.1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The informative priors tightened up the posterior distributions very slightly, which is considered to be in the noise of the overall analysis.</p>
</section>
<section id="comparison-to-a-linear-model">
<h3>Comparison to a Linear Model<a class="headerlink" href="#comparison-to-a-linear-model" title="Permalink to this headline">#</a></h3>
<p>The Bayesian community also has well-established methods for comparing model by using cross-validation.  For illustrative purposes, I’ll compare the SEDCAM model to a linear model with weakly informative priors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">linear_model</span><span class="p">:</span>
    <span class="c1"># Data</span>
    <span class="n">t_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MutableData</span><span class="p">(</span><span class="s1">&#39;t_obs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">Ct_obs</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">MutableData</span><span class="p">(</span><span class="s1">&#39;Ct_obs&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    
    <span class="c1"># Priors</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;slope&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">C0</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">TruncatedNormal</span><span class="p">(</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">136</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">347</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Model Prediction</span>
    <span class="n">Ct</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span> <span class="n">C0</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">t_obs</span><span class="p">)</span>

    <span class="c1"># Likelihood</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="mi">347</span><span class="p">)</span>
    <span class="n">Ct_modeled</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">Ct</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">Ct_obs</span><span class="p">)</span>
<span class="n">linear_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}
            \begin{array}{rcl}
            \text{slope} &amp;\sim &amp; \operatorname{N}(0,~20)\\\text{C0} &amp;\sim &amp; \operatorname{TruncatedNormal}(136,~347,~0,~inf)\\\text{sigma} &amp;\sim &amp; \operatorname{N^{+}}(0,~347)\\\text{Ct} &amp;\sim &amp; \operatorname{Deterministic}(f(\text{C0},~\text{slope}))\\\text{Ct_modeled} &amp;\sim &amp; \operatorname{N}(\text{Ct},~\text{sigma})
            \end{array}
            \end{split}\]</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">model_to_graphviz</span><span class="p">(</span><span class="n">linear_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_81_0.svg" src="_images/02_DocumentingBayes_81_0.svg" /></div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">linear_model</span><span class="p">:</span>
    <span class="n">prior_linear</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_prior_predictive</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">trace_linear</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">target_accept</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [slope, C0, sigma]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
  <progress value='8000' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [8000/8000 00:28&lt;00:00 Sampling 4 chains, 0 divergences]
</div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 64 seconds.
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slope</span> <span class="o">=</span> <span class="n">trace_linear</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;slope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">C0</span> <span class="o">=</span> <span class="n">trace_linear</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">C0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">slope</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">ts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration of Contaminant&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Year</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Concentration</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Data Point&#39;</span><span class="p">,</span> 
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Posterior Samples&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02_DocumentingBayes_83_0.png" src="_images/02_DocumentingBayes_83_0.png" />
</div>
</div>
<p>We can see how the linear model is a poor fit to the data, and would predict negative concentrations in year 30!</p>
<p><code class="docutils literal notranslate"><span class="pre">az.compare</span></code> implements leave-one-out cross validation for the models, then ranks them in order of best performing to worst performing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compare</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">compare</span><span class="p">({</span><span class="s1">&#39;SEDCAM&#39;</span><span class="p">:</span><span class="n">trace</span><span class="p">,</span> <span class="s1">&#39;Linear&#39;</span><span class="p">:</span><span class="n">trace_linear</span><span class="p">})</span>
<span class="n">compare</span><span class="p">[[</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;loo&#39;</span><span class="p">,</span> <span class="s1">&#39;p_loo&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\greg\.conda\envs\pymc_env\lib\site-packages\arviz\stats\stats.py:812: UserWarning: Estimated shape parameter of Pareto distribution is greater than 0.7 for one or more samples. You should consider using a more robust model, this is because importance sampling is less likely to work well if the marginal posterior and LOO posterior are very different. This is more likely to happen with a non-robust model and highly influential observations.
  warnings.warn(
c:\Users\greg\.conda\envs\pymc_env\lib\site-packages\arviz\stats\stats.py:812: UserWarning: Estimated shape parameter of Pareto distribution is greater than 0.7 for one or more samples. You should consider using a more robust model, this is because importance sampling is less likely to work well if the marginal posterior and LOO posterior are very different. This is more likely to happen with a non-robust model and highly influential observations.
  warnings.warn(
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: center;">
      <th></th>
      <th>rank</th>
      <th>weight</th>
      <th>loo</th>
      <th>p_loo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SEDCAM</th>
      <td>0</td>
      <td>1.0</td>
      <td>-21.1</td>
      <td>2.9</td>
    </tr>
    <tr>
      <th>Linear</th>
      <td>1</td>
      <td>0.0</td>
      <td>-36.3</td>
      <td>3.8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><em>Bayesian Modeling and Computation in Python</em> <a class="reference external" href="https://bayesiancomputationbook.com/markdown/chp_02.html">Section 2.5</a> goes into more detail on the metrics provided by Arviz.  I’ll briefly discuss several here.</p>
<p>The conclusion of the model comparison can be summed up by the rank and the weight.  The rank column orders the models from best to worst.  The weight provides an optimal weight that would be assigned to each model if they were combined into an ensemble model.  Based on these weights the linear model is worthless compared to the SEDCAM model.</p>
<p>I’ve included two additional metrics, <code class="docutils literal notranslate"><span class="pre">loo</span></code>, and <code class="docutils literal notranslate"><span class="pre">p_loo</span></code>, which are the basis for the ranks and weights.  <code class="docutils literal notranslate"><span class="pre">loo</span></code> is the leave-out-out expected log pointwise predictive density which evaluates the accuracy of the model with penalties for overfitting.  A higher score is better.  <code class="docutils literal notranslate"><span class="pre">p_loo</span></code> can be generally thought of as the estimated effective number of parameters in the model.  It is interesting to see that the SEDCAM model, which has more parameters than the linear model, has fewer effective parameters. This shows that the structure of the SEDCAM model better describes the data (fewer parameters mean that the model is parsimonious and less likely to overfit).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">az.comparison</span></code> function throws an error message that the models may not be robust to highly influential observations.  This is likely due to the small size of the observed dataset, rather than a model misspecification.</p>
</section>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">#</a></h2>
<p>This notebook runs through the components of a Bayesian analysis for environmental science following <em>Bayesian Analysis Reporting Guidelines</em> in <a class="reference external" href="https://www.nature.com/articles/s41562-021-01177-7">(Kruschke, 2021)</a>.  I hope this is a useful example for Bayesians and non-Bayesians as Bayesian techniques become more commonplace.  The next notebooks will present example models that generally follow this template.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01_BayesIntro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">EnvBayes Notebook #1. Introduction to Bayesian Statistics for Environmental Science</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_HierarchicalStormwater.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">EnvBayes Notebook #3.  Hierarchical Model for Stormwater</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Greg Brunkhorst<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>