
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>EnvBayes Notebook #1. Introduction to Bayesian Statistics for Environmental Science &#8212; Greg Brunkhorst</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="EnvBayes Notebook #2. Documenting a Bayesian Analysis" href="02_DocumentingBayes.html" />
    <link rel="prev" title="About" href="about.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Greg Brunkhorst</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="about.html">
                    About
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   EnvBayes Notebook #1. Introduction to Bayesian Statistics for Environmental Science
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_DocumentingBayes.html">
   EnvBayes Notebook #2. Documenting a Bayesian Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_HierarchicalStormwater.html">
   EnvBayes Notebook #3.  Hierarchical Model for Stormwater
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_Lead210_Master.html">
   EnvBayes Notebook #4.  Bayesian Sediment Geochronology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="logo_asymmetric_laplace.html">
   EnvBayes Logo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="experience.html">
   Greg Brunkhorst, P.E.
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/gbrunkhorst/Website/main?urlpath=lab/tree/01_BayesIntro.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/gbrunkhorst/Website/blob/main/01_BayesIntro.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/gbrunkhorst/Website"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gbrunkhorst/Website/issues/new?title=Issue%20on%20page%20%2F01_BayesIntro.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/01_BayesIntro.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#main-points">
   Main Points
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   1  Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exponential-decay-model-equation">
   2  Exponential Decay Model Equation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#python-implementation-of-the-model">
     Python Implementation of the Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#monte-carlo-simulation">
   3  Monte Carlo Simulation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pymc-simulation-model">
     Pymc Simulation Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulate">
     Simulate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-random-draws">
     Plot Random Draws
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bayesian-model">
   4  Bayesian Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pymc-model">
     Pymc Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-results">
       Plot Results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summary-table">
       Summary Table
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   5 Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   6 Next Steps
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>EnvBayes Notebook #1. Introduction to Bayesian Statistics for Environmental Science</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#main-points">
   Main Points
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   1  Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exponential-decay-model-equation">
   2  Exponential Decay Model Equation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#python-implementation-of-the-model">
     Python Implementation of the Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#monte-carlo-simulation">
   3  Monte Carlo Simulation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pymc-simulation-model">
     Pymc Simulation Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulate">
     Simulate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-random-draws">
     Plot Random Draws
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bayesian-model">
   4  Bayesian Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pymc-model">
     Pymc Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-results">
       Plot Results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summary-table">
       Summary Table
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   5 Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-steps">
   6 Next Steps
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="envbayes-notebook-1-introduction-to-bayesian-statistics-for-environmental-science">
<h1>EnvBayes Notebook #1. Introduction to Bayesian Statistics for Environmental Science<a class="headerlink" href="#envbayes-notebook-1-introduction-to-bayesian-statistics-for-environmental-science" title="Permalink to this headline">#</a></h1>
<section id="main-points">
<h2>Main Points<a class="headerlink" href="#main-points" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Bayesian modeling can be thought of as a forward simulation Monte Carlo analysis that is fit to data.</p></li>
<li><p>Bayesian modeling a natural fit for environmental science.</p></li>
</ul>
<p><em>Note: I have included all the code that generated this notebook, but have hidden all the code that slows down the presentation (e.g., plotting code).  My goal is that the reader does not need to click on any of the “&gt;Click to Show” buttons.</em></p>
</section>
<section id="introduction">
<h2>1  Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>Most introductions to Bayesian statistics start with probability theory and simple toy examples such as a coin flip.  There are many examples out there, and <a class="reference external" href="https://greenteapress.com/wp/think-bayes/"><em>Think Bayes</em></a> by Allen Downey is a nice Python-flavored version.</p>
<p>For environmental scientists, I like to introduce Bayesian statistics starting with a physical model.  Environmental science is rich in forward-simulation physical models, and, given the inherent uncertainty in environmental processes, model input parameters are frequently varied for an uncertainty or sensitivity analyses. This notebook shows how those forward simulations can then be fit to data using probability theory (i.e., Bayesian modeling).  I hope this alternative approach to introducing Bayesian statistics will resonate with some readers.</p>
<p>The rest of this notebook will step through a simple example by 1) presenting a model equation, 2) performing a forward simulation Monte Carlo analysis using the model, and 3) performing Bayesian inference on the model and data.</p>
</section>
<section id="exponential-decay-model-equation">
<h2>2  Exponential Decay Model Equation<a class="headerlink" href="#exponential-decay-model-equation" title="Permalink to this headline">#</a></h2>
<p>For this example, I will use a simple but real-life model from sediment remediation.  Suppose a bay that has been historically contaminated.  Some of that contamination gets bound up with particles and sinks to the sea floor.  We need to know: what will happen to that contamination over time?</p>
<p>Let’s consider only the most important processes in this system - the amount of fresh sediment that is coming in from rivers and runoff, contaminants that are bound up in that fresh sediment, and biological activity that mixes up that sediment.  The old but good SEDCAM model (<a class="reference external" href="https://www.eopugetsound.org/sites/default/files/features/resources/PugetSoundResearch1988Vol2Optimized_0.pdf">Jacobs et al. 1988</a>) is an exponential decay model that incorporates just these processes, and can be written in the following form:</p>
<div class="math notranslate nohighlight">
\[
C_t = C_d(1-e^{-Rt/B}) + C_0e^{-Rt/B}
\]</div>
<p>Where:<br />
<span class="math notranslate nohighlight">\(C_t = \)</span> the surface sediment contaminant concentration at time <span class="math notranslate nohighlight">\(t\)</span><br />
<span class="math notranslate nohighlight">\(C_d = \)</span> the contaminant concentration in depositing sediment<br />
<span class="math notranslate nohighlight">\(C_0 = \)</span> the starting contaminant concentration<br />
<span class="math notranslate nohighlight">\(R = \)</span> the sedimentation rate<br />
<span class="math notranslate nohighlight">\(t = \)</span> time<br />
<span class="math notranslate nohighlight">\(B = \)</span> depth of the biologically active zone</p>
<p>The model is sufficient for our purpose, but highly simplified.  For example, the model ignores changes in sediment density within the sediment bed, degradation or dissolution of contaminants, and changes over time.</p>
<section id="python-implementation-of-the-model">
<h3>Python Implementation of the Model<a class="headerlink" href="#python-implementation-of-the-model" title="Permalink to this headline">#</a></h3>
<p>Here is a Python implementation of the model.</p>
<p>Imports</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">custom_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;axes.spines.right&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;axes.spines.top&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="o">=</span><span class="n">custom_params</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pymc</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
</pre></div>
</div>
</div>
</div>
<p>Wrap the equation in a Python function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Cd</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">B</span><span class="p">))</span> <span class="o">+</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Specify variable values for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cd</span> <span class="o">=</span> <span class="mi">10</span>                     <span class="c1"># ug/kg contaminant</span>
<span class="n">C0</span> <span class="o">=</span> <span class="mi">100</span>                    <span class="c1"># ug/kg contaminant</span>
<span class="n">R</span> <span class="o">=</span> <span class="mi">1</span>                       <span class="c1"># cm/year</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">10</span>                      <span class="c1"># cm</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># years (0-30 in 100 increments)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration of Contaminant&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SEDCAM Exponential Decay Model&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01_BayesIntro_16_0.png" src="_images/01_BayesIntro_16_0.png" />
</div>
</div>
<p>Looks like an exponential decay model!  This is a good start, but we know our model is uncertain, so we will run a forward-simulation Monte Carlo analysis.</p>
</section>
</section>
<section id="monte-carlo-simulation">
<h2>3  Monte Carlo Simulation<a class="headerlink" href="#monte-carlo-simulation" title="Permalink to this headline">#</a></h2>
<p>Monte Carlo simulation is technique where uncertainty is explored by simulating random values from a probability distribution for each input parameter variable.  For each randomly selected combination of inputs, the output variable values are recorded to build up a distribution of potential output values.  The distribution of output values provide a range of potential outcomes, given the uncertainty in the input values.  The book <a class="reference external" href="https://link.springer.com/book/10.1007/978-1-4614-8456-1"><em>EnvStats</em></a> (Millard, 2013) explores Monte Carlo analysis for environmental risk estimation.</p>
<p>Suppose that we generally know the deposition rate <span class="math notranslate nohighlight">\(R\)</span> and the settling concentration <span class="math notranslate nohighlight">\(C_d\)</span> to input into the model from literature and experience.  We think <span class="math notranslate nohighlight">\(R\)</span> is about 1 cm/year with a standard deviation of 0.2, and <span class="math notranslate nohighlight">\(C_d\)</span> is about 10 ug/kg with a standard deviation of 2.  We can specify these input variables as probability distributions in Pymc.</p>
<section id="pymc-simulation-model">
<h3>Pymc Simulation Model<a class="headerlink" href="#pymc-simulation-model" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the distributions need to belong to the model</span>
<span class="n">sedcam_monte</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>

<span class="c1"># the with block tells the distributions who they belong to</span>
<span class="k">with</span> <span class="n">sedcam_monte</span><span class="p">:</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">Cd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;Cd&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simulate">
<h3>Simulate<a class="headerlink" href="#simulate" title="Permalink to this headline">#</a></h3>
<p>The forward simulation Monte Carlo analysis is run using the <code class="docutils literal notranslate"><span class="pre">pm.sample_prior_predictive</span></code> function.  We’ll store the simulation in a variable <code class="docutils literal notranslate"><span class="pre">simulation.</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monte_carlo_samples</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># number of iterations</span>
<span class="c1"># again, run the pymc functions in a with block</span>
<span class="k">with</span> <span class="n">sedcam_monte</span><span class="p">:</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_prior_predictive</span><span class="p">(</span><span class="n">monte_carlo_samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-random-draws">
<h3>Plot Random Draws<a class="headerlink" href="#plot-random-draws" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cd0</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">draws</span> <span class="o">=</span> <span class="mi">50</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">draws</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration of Contaminant&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SEDCAM Exponential Decay Model</span><span class="se">\n</span><span class="s1">Monte Carlo - </span><span class="si">{</span><span class="n">draws</span><span class="si">}</span><span class="s1"> Draws&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01_BayesIntro_24_0.png" src="_images/01_BayesIntro_24_0.png" />
</div>
</div>
<p>We see that the Monte Carlo simulation has generated a whole range of potential outcomes!  Let’s look at the input distributions and the output distribution at year 10 to make sure that they are what we expect.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;Cd&#39;</span><span class="p">]</span>
<span class="n">var_long_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$R$</span><span class="se">\n</span><span class="s1">Deposition Rate&#39;</span><span class="p">,</span> <span class="s1">&#39;$C_d$</span><span class="se">\n</span><span class="s1">Concentration Depositing&#39;</span><span class="p">]))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_names</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="n">var_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">var_long_names</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">sedcam</span><span class="p">(</span><span class="n">Cd0</span><span class="p">,</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$C_</span><span class="si">{10}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">Concentration at Year 10&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Monte Carlo Analysis Results&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01_BayesIntro_26_0.png" src="_images/01_BayesIntro_26_0.png" />
</div>
</div>
<p>Looks about as expected!  The deposition rate and the depositing concentration are consistent with the input specification.  The resulting concentration at year 10 varies from about 30 to 65 ug/kg.</p>
<p>This type of forward simulation is fairly common for environmental extrapolation problems.  For the next section, let’s assume we have some data and turn this into a proper Bayesian model.</p>
</section>
</section>
<section id="bayesian-model">
<h2>4  Bayesian Model<a class="headerlink" href="#bayesian-model" title="Permalink to this headline">#</a></h2>
<p>We used our experience and knowledge to extrapolate concentrations into the future and estimate uncertainty in those concentrations.  Now, let’s assume we have data at year 10.  But, given the hard economic times, we only get one data point!  This happens to be at the low end of our range at 30 ug/kg.  Let’s also assume that we know the measurement error in the value is 3 ug/kg (standard deviation) which we get from the laboratory report.  (Note this model does not include environmental  [i.e., sampling error] - another simplifying assumption for presentation purposes.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># observed data</span>
<span class="n">Ct_obs</span> <span class="o">=</span> <span class="mi">30</span>      <span class="c1"># ug/kg</span>
<span class="n">sigma_Ct_obs</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># ug/kg</span>
<span class="n">t_obs</span> <span class="o">=</span> <span class="mi">10</span>       <span class="c1"># years</span>
</pre></div>
</div>
</div>
</div>
<section id="pymc-model">
<h3>Pymc Model<a class="headerlink" href="#pymc-model" title="Permalink to this headline">#</a></h3>
<p>We will rewrite the Pymc model to include the SEDCAM model equation and observed data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a pymc model called sedcam_bayes</span>
<span class="n">sedcam_bayes</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>
<span class="k">with</span> <span class="n">sedcam_bayes</span><span class="p">:</span>
    <span class="c1"># same as above - these are called priors</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">Cd</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;Cd&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># add the SEDCAM model equation - wrap it in a pm.Deterministic variable for tracking</span>
    <span class="n">Ct</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span> 
        <span class="n">Cd</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t_obs</span><span class="o">/</span><span class="n">B</span><span class="p">))</span> <span class="o">+</span> <span class="n">C0</span> <span class="o">*</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="o">*</span><span class="n">t_obs</span><span class="o">/</span><span class="n">B</span><span class="p">))</span>

    <span class="c1"># add observed data - assume normal error (likelihood) around the predicted value Ct</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">Ct</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_Ct_obs</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">Ct_obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Above, we called <code class="docutils literal notranslate"><span class="pre">pm.sample_prior_predictive()</span></code>, which ignores any data in the model.  Now we call <code class="docutils literal notranslate"><span class="pre">pm.sample()</span></code>, which accounts the entire model.  In this step, probability theory (Bayes rule) is used to draw values from the posterior distribution, which considers both the prior probability distributions and the data.  The results are commonly called the “trace.”  This is performed using sophisticated Markov Chain Monte Carlo (MCMC) methods under the hood in Pymc.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">sedcam_bayes</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
    <span class="n">post_pred</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_posterior_predictive</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initializing NUTS using jitter+adapt_diag...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Multiprocess sampling (4 chains in 4 jobs)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NUTS: [R, Cd]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
  <progress value='5173' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  64.66% [5173/8000 00:04&lt;00:02 Sampling 4 chains, 0 divergences]
</div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 2 chains for 1_000 tune and 999 draw iterations (2_000 + 1_998 draws total) took 25 seconds.
</pre></div>
</div>
</div>
</div>
<section id="plot-results">
<h4>Plot Results<a class="headerlink" href="#plot-results" title="Permalink to this headline">#</a></h4>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cd0</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">R0</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">Cd</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;Cd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">sedcam</span><span class="p">(</span><span class="n">Cd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ts</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration of Contaminant&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_obs</span><span class="p">,</span> <span class="n">Ct_obs</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Observed&#39;</span><span class="p">,</span> 
         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison of Predictions</span><span class="se">\n</span><span class="s1">Before and After Bayesian Inference&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01_BayesIntro_36_0.png" src="_images/01_BayesIntro_36_0.png" />
</div>
</div>
<p>Draws from the prior distribution (black) are wider and higher than the posterior distribution (blue).  The single observed data point tightened up our predictions!  But, importantly, uncertainty (i.e., probability distributions) are still part of the model.</p>
<p>Let’s plot the input parameters and the predicted concentration at year 10.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;Cd&#39;</span><span class="p">]</span>
<span class="n">var_long_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$R$</span><span class="se">\n</span><span class="s1">Deposition Rate&#39;</span><span class="p">,</span> <span class="s1">&#39;$C_d$</span><span class="se">\n</span><span class="s1">Concentration Depositing&#39;</span><span class="p">]))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_names</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">posterior</span><span class="p">[</span><span class="n">var_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">var_long_names</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">post_pred</span><span class="o">.</span><span class="n">posterior_predictive</span><span class="p">[</span><span class="s1">&#39;Ct_modeled&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$C_</span><span class="si">{10}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">Concentration at Year 10&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Ct_obs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Bayesian Inference Results&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01_BayesIntro_38_0.png" src="_images/01_BayesIntro_38_0.png" />
</div>
</div>
<ul class="simple">
<li><p>As expected, the deposition rate <span class="math notranslate nohighlight">\(R\)</span> has increased as a result of the data (compared to the prior), and the depositing concentration <span class="math notranslate nohighlight">\(C_d\)</span> has decreased (slightly) compared to the prior.</p></li>
<li><p>The concentration at year 10 (<span class="math notranslate nohighlight">\(C_{10}\)</span>) has a tighter distribution after Bayesian inference.  The values center slightly above the observed data due to the combination of the observed data and the prior.</p></li>
</ul>
<p>The results of the Bayesian analysis can be summarized in a table using the Arviz package.</p>
</section>
<section id="summary-table">
<h4>Summary Table<a class="headerlink" href="#summary-table" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="o">=</span><span class="mf">.90</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_5%</th>
      <th>hdi_95%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>R</th>
      <td>1.3</td>
      <td>0.1</td>
      <td>1.2</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>Cd</th>
      <td>9.0</td>
      <td>1.9</td>
      <td>5.9</td>
      <td>12.2</td>
    </tr>
    <tr>
      <th>Ct</th>
      <td>33.0</td>
      <td>2.4</td>
      <td>29.0</td>
      <td>37.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>HDI (highest density interval) is similar to a confidence interval.  <a class="reference external" href="https://en.wikipedia.org/wiki/Credible_interval">Here</a> is the Wikipedia article on the topic.</p>
</section>
</section>
</section>
<section id="summary">
<h2>5 Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h2>
<p>My goal in writing this notebook was to show how a forward-simulation model can be turned into a Bayesian model.  Bayesian statistics and environmental data are a natural fit because of the plethora of forward simulation models, the small size of many data sets, and because uncertainty is important.</p>
<p>Here is how I depict the process of Bayesian inference:</p>
<p><img alt="BayesianInference" src="_images/BayesianInference.png" /></p>
<p>The Monte Carlo simulation is the first row of the diagram, where synthetic data can be generated using forward-simulation.  Bayesian inference then uses the forward simulation model and the observed data to recalculate model parameter distributions using inverse probability.  The posterior model parameter distributions will generally tighten up (become more certain) after “seeing” the data, as shown in the diagram.</p>
<p>A couple of canonical examples opened my eyes to how Bayesian models can accommodate arbitrary data generating processes.  The <a class="reference external" href="https://docs.pymc.io/en/v3/pymc-examples/examples/case_studies/putting_workflow.html">golf putting example</a> models a dataset of golf putt successes (made/ not made) vs. distance from the hole.  The example compares a logistic regression model, which is the natural statistical model for modeling yes/ no results, to a basic physical model that incorporates the size of the golf ball, the size of the hole, and the angle of the putter head.  The physical model provides a much more realistic fit to the data.</p>
<p>Another example is the <a class="reference external" href="https://www.pymc.io/projects/docs/en/latest/learn/core_notebooks/pymc_overview.html#pymc-overview">coal mine disaster analysis</a> which runs a switch-point regression on the classic coal miners dataset.  In this case, the model is simply two horizontal lines and a switch point.  Despite the simplicity of the model, it would be difficult to implement with coherent uncertainty estimates outside the Bayesian context.</p>
</section>
<section id="next-steps">
<h2>6 Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">#</a></h2>
<p>To reiterate, Bayesian statistics is just Monte Carlo simulation fit to data.  Once we know that, then we can apply statistics to all sorts of unique situations.  However, there are some components to the Bayesian workflow that are unique to this style of analysis.  The next notebook provides a template for reporting Bayesian analyses.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="about.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">About</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="02_DocumentingBayes.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">EnvBayes Notebook #2. Documenting a Bayesian Analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Greg Brunkhorst<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>